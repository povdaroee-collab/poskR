<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | POS System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;700&family=Poppins:wght@300;400;600&display=swap');
        body { font-family: 'Poppins', 'Kantumruy Pro', sans-serif; }
        
        /* Smooth Sidebar Transition */
        .sidebar { transition: all 0.3s ease; }
        
        /* Table Row Hover */
        tr { transition: background-color 0.2s; }
        
        /* Glass Effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex overflow-hidden">

    <aside class="w-64 bg-white shadow-2xl z-20 hidden md:flex flex-col">
        <div class="h-20 flex items-center justify-center border-b">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                    <i class="fas fa-cash-register"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-800">POS Admin</h1>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-2 px-4">
                <li>
                    <a href="/" class="flex items-center gap-4 px-4 py-3 bg-blue-50 text-blue-600 rounded-xl font-bold shadow-sm transition-all">
                        <i class="fas fa-chart-pie"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="/pos" class="flex items-center gap-4 px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-xl transition-all">
                        <i class="fas fa-store"></i> ·ûë·üÖ·ûÄ·û∂·ûì·üã·ûÄ·û∂·ûö·ûõ·ûÄ·üã (POS)
                    </a>
                </li>
                <li class="pt-4 pb-2 text-xs text-gray-400 uppercase font-bold px-4">·ûö·ûî·û∂·ûô·ûÄ·û∂·ûö·ûé·üç</li>
                <li>
                    <a href="/export/excel" class="flex items-center gap-4 px-4 py-3 text-gray-600 hover:bg-green-50 hover:text-green-600 rounded-xl transition-all">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </a>
                </li>
                <li>
                    <a href="/export/pdf" class="flex items-center gap-4 px-4 py-3 text-gray-600 hover:bg-red-50 hover:text-red-600 rounded-xl transition-all">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </a>
                </li>
            </ul>
        </nav>

        <div class="p-4 border-t">
            <a href="/logout" class="flex items-center gap-3 px-4 py-3 text-red-500 hover:bg-red-50 rounded-xl transition-all font-medium">
                <i class="fas fa-sign-out-alt"></i> ·ûÖ·û∂·ûÄ·ûÖ·üÅ·ûâ
            </a>
        </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden relative">
        
        <header class="h-20 bg-white/80 backdrop-blur-md shadow-sm flex items-center justify-between px-8 z-10">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">·ûë·û∑·ûä·üí·ûã·ûó·û∂·ûñ·ûë·ûº·ûë·üÖ (Dashboard)</h2>
                <p class="text-sm text-gray-500">·ûü·ûΩ·ûü·üí·ûè·û∏, <%= typeof user !== 'undefined' ? user.name : 'Owner' %> üëã</p>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl shadow-lg shadow-blue-500/30 transition-transform active:scale-95 flex items-center gap-2">
                    <i class="fas fa-plus"></i> ·ûî·ûì·üí·ûê·üÇ·ûò·ûë·üÜ·ûì·û∑·ûâ
                </button>
                <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-white shadow">
                    <img src="https://ui-avatars.com/api/?name=<%= typeof user !== 'undefined' ? user.name : 'Admin' %>&background=0D8ABC&color=fff" alt="Profile">
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar">
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">·ûÖ·üÜ·ûé·ûº·ûõ·ûü·ûö·ûª·ûî</p>
                            <h3 class="text-3xl font-bold text-gray-800 mt-2">$<%= totalRevenue %></h3>
                        </div>
                        <div class="p-3 bg-green-100 text-green-600 rounded-lg">
                            <i class="fas fa-dollar-sign text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">·ûë·üÜ·ûì·û∑·ûâ·ûü·ûö·ûª·ûî</p>
                            <h3 class="text-3xl font-bold text-gray-800 mt-2"><%= productCount %></h3>
                        </div>
                        <div class="p-3 bg-blue-100 text-blue-600 rounded-lg">
                            <i class="fas fa-box text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">·ûÄ·û∂·ûö·ûõ·ûÄ·üã·ûê·üí·ûò·û∏·üó</p>
                            <h3 class="text-3xl font-bold text-gray-800 mt-2"><%= recentSales.length %></h3>
                        </div>
                        <div class="p-3 bg-purple-100 text-purple-600 rounded-lg">
                            <i class="fas fa-shopping-cart text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 rounded-2xl shadow-lg shadow-blue-500/20 text-white animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
                    <p class="text-blue-100 text-sm">·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë</p>
                    <h3 class="text-xl font-bold mt-2" id="currentDate">Loading...</h3>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden animate__animated animate__fadeInLeft">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h3 class="font-bold text-gray-800">·ûÄ·û∂·ûö·ûõ·ûÄ·üã·ûê·üí·ûò·û∏·üó (Recent Sales)</h3>
                        <a href="#" class="text-sm text-blue-600 hover:underline">·ûò·ûæ·ûõ·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã</a>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-50 text-gray-500 text-sm uppercase">
                                <tr>
                                    <th class="p-4 font-medium">ID</th>
                                    <th class="p-4 font-medium">·û¢·üí·ûì·ûÄ·ûÇ·û∑·ûè·ûõ·ûª·ûô</th>
                                    <th class="p-4 font-medium">·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë</th>
                                    <th class="p-4 font-medium text-right">·ûë·ûπ·ûÄ·ûî·üí·ûö·û∂·ûÄ·üã</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm divide-y divide-gray-100">
                                <% if(recentSales.length > 0) { %>
                                    <% recentSales.forEach(sale => { %>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-4 text-gray-600">#<%= sale.id.substring(0, 6) %>...</td>
                                        <td class="p-4 font-medium text-gray-800"><%= sale.cashierName || sale.cashier %></td>
                                        <td class="p-4 text-gray-500"><%= sale.dateString %></td>
                                        <td class="p-4 text-right font-bold text-green-600">$<%= parseFloat(sale.total).toFixed(2) %></td>
                                    </tr>
                                    <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="4" class="p-6 text-center text-gray-400">·ûò·û∑·ûì·ûë·û∂·ûì·üã·ûò·û∂·ûì·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô·ûõ·ûÄ·üã</td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate__animated animate__fadeInRight">
                    <h3 class="font-bold text-gray-800 mb-4">·ûü·üí·ûê·û∑·ûè·û∑·ûî·üí·ûö·ûÖ·û∂·üÜ·ûü·ûî·üí·ûè·û∂·û†·üç</h3>
                    <canvas id="salesChart" height="250"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden animate__animated animate__fadeInUp">
                <div class="p-6 border-b">
                    <h3 class="font-bold text-gray-800">·ûî·ûâ·üí·ûá·û∏·ûë·üÜ·ûì·û∑·ûâ·ûÄ·üí·ûì·ûª·ûÑ·ûü·üí·ûè·ûª·ûÄ (Stock Inventory)</h3>
                </div>
                <div class="overflow-x-auto max-h-96">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-50 text-gray-500 text-sm uppercase sticky top-0">
                            <tr>
                                <th class="p-4 font-medium">·ûà·üí·ûò·üÑ·üá·ûë·üÜ·ûì·û∑·ûâ</th>
                                <th class="p-4 font-medium">Barcode</th>
                                <th class="p-4 font-medium">·ûî·üí·ûö·ûó·üÅ·ûë</th>
                                <th class="p-4 font-medium">·ûè·ûò·üí·ûõ·üÉ ($)</th>
                                <th class="p-4 font-medium text-center">·ûü·üí·ûè·ûª·ûÄ</th>
                                <th class="p-4 font-medium text-center">·ûü·ûÄ·ûò·üí·ûò·ûó·û∂·ûñ</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm divide-y divide-gray-100">
                            <% products.forEach(product => { %>
                            <tr class="hover:bg-gray-50">
                                <td class="p-4 font-bold text-gray-800"><%= product.name %></td>
                                <td class="p-4 text-gray-500 font-mono"><%= product.barcode %></td>
                                <td class="p-4">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-600 rounded-md text-xs font-bold"><%= product.category %></span>
                                </td>
                                <td class="p-4 text-gray-800 font-medium">$<%= product.price %></td>
                                <td class="p-4 text-center">
                                    <% if(product.stock <= 5) { %>
                                        <span class="text-red-500 font-bold"><%= product.stock %> (Low)</span>
                                    <% } else { %>
                                        <span class="text-green-600 font-bold"><%= product.stock %></span>
                                    <% } %>
                                </td>
                                <td class="p-4 text-center">
                                    <button onclick="confirmDelete('<%= product.id %>')" class="w-8 h-8 rounded-full bg-red-100 text-red-500 hover:bg-red-500 hover:text-white transition-colors">
                                        <i class="fas fa-trash-alt text-xs"></i>
                                    </button>
                                </td>
                            </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <div id="productModal" class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center animate__animated animate__fadeIn">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="text-lg font-bold text-gray-800">·ûî·ûì·üí·ûê·üÇ·ûò·ûë·üÜ·ûì·û∑·ûâ·ûê·üí·ûò·û∏</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-red-500 text-xl">&times;</button>
            </div>
            
            <form action="/product/add" method="POST" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">·ûà·üí·ûò·üÑ·üá·ûë·üÜ·ûì·û∑·ûâ</label>
                    <input type="text" name="name" required class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none bg-gray-50">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">·ûè·ûò·üí·ûõ·üÉ ($)</label>
                        <input type="number" step="0.01" name="price" required class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">·ûÖ·üÜ·ûì·ûΩ·ûì·ûü·üí·ûè·ûª·ûÄ</label>
                        <input type="number" name="stock" required class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none bg-gray-50">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Barcode</label>
                        <input type="text" name="barcode" class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">·ûî·üí·ûö·ûó·üÅ·ûë (Category)</label>
                        <select name="category" class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none bg-gray-50">
                            <option value="Drink">·ûó·üÅ·ûü·ûá·üí·ûá·üà</option>
                            <option value="Food">·û¢·û∂·û†·û∂·ûö</option>
                            <option value="General">·ûë·ûº·ûë·üÖ</option>
                        </select>
                    </div>
                </div>

                <div class="pt-4">
                    <button type="submit" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/30 transition-all">
                        ·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ (Save Product)
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Set Date
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('km-KH', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        // Chart.js (Dummy Data for visual)
        const ctx = document.getElementById('salesChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Sales ($)',
                    data: [120, 190, 300, 250, 200, 350, 400],
                    backgroundColor: '#3B82F6',
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } }
            }
        });

        // Modal Functions
        function openModal() {
            const modal = document.getElementById('productModal');
            modal.classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('productModal');
            modal.classList.add('hidden');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Delete Confirmation
        function confirmDelete(id) {
            Swal.fire({
                title: '·ûè·ûæ·û¢·üí·ûì·ûÄ·ûÖ·üí·ûî·û∂·ûü·üã·ûë·üÅ?',
                text: "·û¢·üí·ûì·ûÄ·ûì·ûπ·ûÑ·ûò·û∑·ûì·û¢·û∂·ûÖ·ûô·ûÄ·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô·ûì·üÅ·üá·ûò·ûÄ·ûú·û∑·ûâ·ûî·û∂·ûì·û°·ûæ·ûô!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF4444',
                cancelButtonColor: '#3B82F6',
                confirmButtonText: '·ûî·û∂·ûë/·ûÖ·û∂·ûü, ·ûõ·ûª·ûî·ûÖ·üÑ·ûõ!',
                cancelButtonText: '·ûë·üÅ'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `/product/delete/${id}`;
                }
            })
        }
    </script>
</body>
</html>